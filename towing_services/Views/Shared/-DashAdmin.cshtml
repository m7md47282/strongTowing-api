<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashbord Admin</title>



    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JS (يُفضّل وضعه قبل نهاية الـ body) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



    <link href="~/css/site.css" rel="stylesheet" />

    <style>
      
        ul li {
        margin:20px 19px; /* إضافة المسافة بين العناصر */
        white-space: nowrap; /* منع النص من الانتقال إلى سطر جديد */
    }

    .nav-item .nav-link {
        text-transform: uppercase;
        color:white !important
    }





    ::-webkit-scrollbar {
        width: 5px; /* عرض شريط التمرير */
    }

    ::-webkit-scrollbar-thumb {
        background-color: #516f90; /* لون مقبض شريط التمرير */
        border-radius: 5px; /* جعل الأطراف دائرية */
        height: 10px; /* تحديد الطول الأدنى لمقبض شريط التمرير */
    }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #1abc9c; /* تغيير لون المقبض عند التمرير */
        }

    /* يمكن إضافة ستايل لشريط التمرير إذا أردت تخصيص الخلفية */
    ::-webkit-scrollbar-track {
        background-color: #f1f1f1; /* خلفية شريط التمرير */
    }


    .as {
        position: relative;
        display: inline-block;
        font-size: 22px;
        font-weight: 400;
        text-decoration: none;
    }

        .as::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #1e90ff);
            bottom: 0;
            left: 0;
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease-out;
        }

        .as:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

    .navbar-brand {
        text-align: center;
        padding-left: 22px; /* إزالة الحشوات */
        display: flex;
        justify-content: center; /* لضمان محاذاة العناصر في المنتصف */
        align-items: center; /* لضمان محاذاة العناصر عموديًا */
        font-size:26px !important
    }
    /***/
    /* شكل زر التبديل */
    .navbar-toggler {
        border: none;
        background: transparent;
        display: flex;
        flex-direction: column;
        gap: 5px;
        cursor: pointer;
    }

    /* الخطوط الخاصة بالزر */
    .toggler-icon {
        width: 30px;
        height: 4px;
            background-color: #1e90ff;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }

    /* عند تفعيل الزر، تحوله إلى X */
    .navbar-toggler.active .toggler-icon:nth-child(1) {
        transform: translateY(9px) rotate(45deg);
    }

    .navbar-toggler.active .toggler-icon:nth-child(2) {
        transform: translateY(-4px) rotate(-45deg);
    }



        .navbar-collapse.show {
            max-height: 500px;
        }


    .navbar-toggler {
        position: absolute;
        right: 15px; /* تأكد من ثباته على اليمين */
        top: 25px;
    }

        .navbar-light{
            background: #040606 !important
        }

        .badge {
            animation: pulse 1s infinite;
        }

   
    </style>
</head>
<body >

    <nav class="navbar navbar-expand-xl navbar-light ">
        <div class="container-fluid ">
            <div class="navbar-wrapper">
                <h1 class="navbar-brand " asp-controller="Home" asp-action="Home" style="  color: #1e90ff">

                    Dashbord Admin
                </h1>
            </div>
            <!-- زر التبديل -->
            <button class="navbar-toggler" type="button" id="toggleButton" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <div class="toggler-icon"></div>
                <div class="toggler-icon"></div>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav  ms-auto ">


                  <li class="nav-item">
                       @*  <a class="nav-link   as" aria-current="page" asp-controller="admin1" asp-action="IIndexPartialView" >
                            New_Orders

                        </a>
                      *@
                        <a class="nav-link as" asp-controller="admin1" asp-action="IIndexPartialView">
                            New Orders
                            <span id="newOrderCount" class="badge rounded-pill bg-danger" style="display:inline-block; margin-left: 10px; font-size:20px">
                                0
                            </span>
                        </a>




                    </li> 

                    
                    <li class="nav-item">
                        <a class="nav-link active n as" aria-current="page" asp-controller="admin1" asp-action="CreateHR">
                            HR
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link as " asp-controller="admin1" asp-action="GetDriver" >
                            DRIVER
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link as " asp-controller="admin1" asp-action="show_driver">
                          NEW  DRIVERS 
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link as" asp-controller="Home" asp-action="Logout" >
                            LOGOUT
                        </a>
                    </li>
                  









                    @*    <a class="nav-link active" aria-current="page"  style="font-size: 20px; color: black">
                    Home
                    @if (TempData["NewDriver"] != null)
                    {
                        <span class="badge bae bg-danger" style="font-size: 1rem;"> !</span>
                    }
                </a> *@
                </ul>


              
            </div>
        </div>
    </nav>









    <div class="container-fluid">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

   @*  <footer class="border-top footer text-muted " style="background: #f1f1f1; padding: 16px">
        <div class="container">

            <div style="color:black; font-size:18px ; text-align:center">
                &copy; @DateTime.Now.Year - Strong Towing

            </div>
        </div>
    </footer> *@
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)








</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js"></script>
<script >
     document.addEventListener("DOMContentLoaded", function () {
        const toggleButton = document.getElementById("toggleButton");
        const navbarNav = document.getElementById("navbarNav");

        toggleButton.addEventListener("click", function () {
            this.classList.toggle("active");

            navbarNav.classList.toggle("show");
        });
    });




    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/orderHub")
        .build();

    connection.start().then(() => {
        console.log("✅ SignalR connection established");
    }).catch(err => {
        console.error("❌ Error while establishing connection: " + err);
    });

    connection.on("ReceiveNewOrderNotification", function (newOrderCount, message) {
        console.log("🔔 New order count received: " + newOrderCount);

        const orderCountElement = document.getElementById("newOrderCount");
        if (orderCountElement) {
            orderCountElement.innerText = newOrderCount;
            orderCountElement.style.display = 'inline-block';
        }

        showNotification(message);

        playNotificationSound();
    });

    function showNotification(message) {
        let notification = document.createElement("div");
        notification.classList.add("notification");
        notification.innerText = message;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    function playNotificationSound() {
        var audio = new Audio('/soundtest1/nottest.wav');  
        audio.play();  
    }







    //   "use client";

    // const connection = new signalR.HubConnectionBuilder().withUrl("/orderHub").build();

    // console.log(connection.state); // سيعرض حالة الاتصال
    // connection.on("UpdateOrderCount", function(count) {
    //     const badge = document.getElementById("newOrderCount");
    //     if (badge) {
    //         badge.textContent = count;
    //         badge.style.display = count > 0 ? "inline-block" : "none";
    //     }
    // });

    // connection.start().catch(function(err) {
    //     return console.error(err.toString());
    // });




    // // //2

    // //    "use strict";

    // // const connection = new signalR.HubConnectionBuilder().withUrl("/orderHub").build();

    // // connection.on("UpdateOrderCount", function (count) {
    // //     localStorage.setItem("newOrdersCount", count);
    // //     updateBadge(count);
    // //     showNotification(count);
    // //     playNotificationSound();
    // // });

    // // function updateBadge(count) {
    // //     const badge = document.getElementById("newOrderCount");
    // //     if (badge) {
    // //         badge.textContent = count;
    // //         badge.style.display = count > 0 ? "inline-block" : "none";
    // //     }
    // // }

    // // function playNotificationSound() {
    // //     const audio = new Audio("/soundtest1/nottest.wav");
    // //     audio.play();
    // // }

    // // function showNotification(count) {
    // //     if (Notification.permission === "granted") {
    // //         new Notification("🚀 طلب جديد!", {
    // //             body: `لديك ${count} طلبات جديدة.`,
    // //             icon: "/images/order-icon.png"
    // //         });
    // //     } else if (Notification.permission !== "denied") {
    // //         Notification.requestPermission().then(permission => {
    // //             if (permission === "granted") {
    // //                 showNotification(count);
    // //             }
    // //         });
    // //     }
    // // }

    // // async function startConnection() {
    // //     try {
    // //         await connection.start();
    // //         console.log("✅ SignalR Connected.");

    // //         const storedCount = localStorage.getItem("newOrdersCount");
    // //         if (storedCount !== null) {
    // //             updateBadge(storedCount);
    // //         }
    // //     } catch (err) {
    // //         console.error("❌ SignalR Connection Failed:", err);
    // //         setTimeout(startConnection, 5000);
    // //     }
    // // }

    // // connection.onclose(startConnection);
    // // startConnection();





    // //       "use strict";

    // // const connection = new signalR.HubConnectionBuilder()
    // //     .withUrl("/orderHub")
    // //     .withAutomaticReconnect([0, 3000, 5000, 10000])
    // //     .build();

    // // function updateAllPagesBadge(count) {
    // //     updateBadge(count);
    // //     document.title = `(${count}) New Orders`;
    // // }

    // // function updateBadge(count) {
    // //     let badge = document.getElementById("newOrderCount");
    // //     if (!badge) {
    // //         console.warn("⚠️ Badge element not found, retrying...");
    // //         setTimeout(() => updateBadge(count), 1000);
    // //         return;
    // //     }

    // //     badge.textContent = count;
    // //     badge.style.display = count > 0 ? "inline-block" : "none";
    // // }

    // // function showNotification(count) {
    // //     if (Notification.permission === "granted") {
    // //         new Notification("🚀 New Order!", {
    // //             body: `You have ${count} new orders.`,
    // //             icon: "/images/order-icon.png"
    // //         });
    // //     } else if (Notification.permission !== "denied") {
    // //         Notification.requestPermission().then(permission => {
    // //             if (permission === "granted") {
    // //                 showNotification(count);
    // //             }
    // //         });
    // //     }
    // // }

    // // function restoreOrderCount() {
    // //     const storedCount = localStorage.getItem("newOrdersCount");
    // //     if (storedCount !== null) {
    // //         console.log("🔄 Restoring count from LocalStorage:", storedCount);
    // //         updateBadge(parseInt(storedCount));
    // //     }
    // // }

    // // async function startConnection() {
    // //     try {
    // //         await connection.start();
    // //         console.log("✅ SignalR connected successfully.");
    // //         restoreOrderCount();
    // //     } catch (err) {
    // //         console.error("❌ SignalR connection failed:", err);
    // //         setTimeout(startConnection, 5000);
    // //     }
    // // }

    // // connection.onclose(startConnection);

    // // connection.on("UpdateOrderCount", function(count) {
    // //     console.log("🔄 Receiving new order count:", count);
    // //     localStorage.setItem("newOrdersCount", count);
    // //     window.dispatchEvent(new Event("storage"));
    // //     updateAllPagesBadge(count);
    // //     showNotification(count);
    // // });

    // // window.addEventListener("storage", function(event) {
    // //     if (event.key === "newOrdersCount") {
    // //         const newCount = parseInt(event.newValue);
    // //         console.log("🔄 Updating count from local storage:", newCount);
    // //         updateAllPagesBadge(newCount);
    // //     }
    // // });

    // // document.addEventListener("DOMContentLoaded", function() {
    // //     restoreOrderCount();
    // //     startConnection();
    // // });
          // إنشاء الاتصال مع SignalR
    // // // // // // // const connection = new signalR.HubConnectionBuilder()
    // // // // // // //     .withUrl("/orderHub")
    // // // // // // //     .build();

    // // // // // // // // تحقق من نجاح الاتصال
    // // // // // // // connection.start().then(function () {
    // // // // // // //     console.log("SignalR connection established");
    // // // // // // // }).catch(function (err) {
    // // // // // // //     console.error("Error while establishing connection: " + err);
    // // // // // // // });

    // // // // // // // // استقبال الإشعار عند وصول طلب جديد
    // // // // // // // connection.on("ReceiveNewOrderNotification", function (newOrderCount, message) {
    // // // // // // //     console.log("New order count received: " + newOrderCount);

    // // // // // // //     // تحديث عدد الطلبات الجديدة
    // // // // // // //     const orderCountElement = document.getElementById("newOrderCount");
    // // // // // // //     if (orderCountElement) {
    // // // // // // //         orderCountElement.innerText = newOrderCount;
    // // // // // // //         orderCountElement.style.display = 'inline-block';
    // // // // // // //     }

    // // // // // // //     // عرض رسالة تأكيد باستخدام Toast أو Alert
    // // // // // // //     showNotification(message);

    // // // // // // //     // تحديث الطلبات داخل الصفحة تلقائيًا
    // // // // // // //     $("#ordersContainer").load('/admin1/IIndexPartialView?page=1&pageInProgress=1 #ordersContainer');
    // // // // // // // });

    // // // // // // // // دالة لإظهار إشعار
    // // // // // // // function showNotification(message) {
    // // // // // // //     let notification = document.createElement("div");
    // // // // // // //     notification.classList.add("notification");
    // // // // // // //     notification.innerText = message;

    // // // // // // //     document.body.appendChild(notification);

    // // // // // // //     setTimeout(() => {
    // // // // // // //         notification.remove();
    // // // // // // //     }, 5000); // يختفي بعد 5 ثوانٍ
    // // // // // // // }


// // //     $(document).ready(function () {
// // //     // إنشاء اتصال SignalR مع الهب
// // //     const connection = new signalR.HubConnectionBuilder()
// // //         .withUrl("/orderHub")
// // //         .build();

// // //     // بدء الاتصال
// // //     connection.start().then(() => {
// // //         console.log("✅ SignalR connection established");
// // //         updateTable(); // ✅ تحميل البيانات عند فتح الصفحة
// // //     }).catch(err => {
// // //         console.error("❌ Error while establishing connection: " + err);
// // //     });

// // //     // استقبال الإشعار عند وصول طلب جديد
// // //     connection.on("ReceiveNewOrderNotification", function (newOrderCount, message) {
// // //         console.log("🔔 New order count received: " + newOrderCount);

// // //         // تحديث عدد الطلبات الجديدة
// // //         const orderCountElement = document.getElementById("newOrderCount");
// // //         if (orderCountElement) {
// // //             orderCountElement.innerText = newOrderCount;
// // //             orderCountElement.style.display = 'inline-block';
// // //         }

// // //         // عرض إشعار للمستخدم
// // //         showNotification(message);

// // //         // ✅ تحديث الجدول إذا كنا في الصفحة التي تحتوي عليه
// // //         if ($("#tableContainer").length) {
// // //             updateTable();
// // //         }
// // //     });

// // //     // ✅ تحميل البيانات عند فتح الصفحة أو تحديثها عند وصول طلب جديد
// // //     function updateTable() {
// // //         console.log("🔄 Fetching orders...");
// // //         $.ajax({
// // //             url: "/admin1/IIndexPartialView", // تأكد من أن هذا هو المسار الصحيح
// // //             type: "GET",
// // //             success: function (data) {
// // //                 $("#tableContainer").html(data);
// // //                 console.log("✅ Table loaded successfully");
// // //             },
// // //             error: function (xhr) {
// // //                 console.error("❌ Error loading table: " + xhr.status + " " + xhr.statusText);
// // //             }
// // //         });
// // //     }

// // //     // دالة لإظهار إشعار بسيط
// // //     function showNotification(message) {
// // //         let notification = document.createElement("div");
// // //         notification.classList.add("notification");
// // //         notification.innerText = message;

// // //         document.body.appendChild(notification);

// // //         setTimeout(() => {
// // //             notification.remove();
// // //         }, 5000);
// // //     }
// // // });
      

</script>

