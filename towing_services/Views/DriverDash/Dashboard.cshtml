@model Dal.Driver
@{
    Layout = "~/Views/Shared/-Driver.cshtml";
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body {
        background: #f8f8f8;
    }


    .bt {
        position: relative;
        padding: 0.60em 1em;
        background-color: #38ACEC;
        border: 4px solid #fff; /* تحديد حدود الزر بلون أبيض */
        color: black;
        font-size: 20px;
        text-transform: uppercase;
        font-weight: bold;
        cursor: pointer;
        border-radius: 50px;
        overflow: hidden;
        transition: color 0.3s, border-color 0.3s;
        z-index: 1;
    }

        .bt::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: #15317E;
            transition: left 0.5s ease;
            z-index: -1;
        }


        .bt:hover {
            color: black;
            border-color: #3b5bdb;
        }

    .btn:hover::before {
        left: 0;
    }

    .bt:hover {
        color: #ddd;
    }


    .wave-container {
        position: relative;
        width: 100%;
        overflow: hidden;
        text-align: center;
        background-color: #f9f9f9; /* Background color for better visibility */
    }

    .welcome-message {
        position: relative; /* موقع ثابت داخل الحاوية */
        margin-top: -150px;
        font-size: 36px;
        line-height: 1.6;
        color: black;
        text-align: center;
    }
    /* Title styling */
    .wave-title {
        position: absolute;
        top: 20%;
        width: 100%;
        font-size: 3.50rem;
        font-weight: bold;
        color: black;
        text-transform: uppercase;
        z-index: 1;
    }

    /* SVG styling */
    #wave {
        width: 100%;
        height: auto;
    }





    @@media (max-width: 2000px) {
        .welcome-message {
            margin-top: 3vh;
            font-size: 29px;
        }

        .wave-title {
            font-size: 3rem;
        }
    }


    @@media (max-width: 768px) {
        .welcome-message {
            margin-top: 6vh;
            font-size: 20px;
        }

        .wave-title {
            font-size: 2.5rem;
        }
    }

    /* Media query لأجهزة الجوال */
    @@media (max-width: 480px) {
        .welcome-message {
            margin-top: 30vh;
            font-size: 15px;
        }

        .wave-title {
            font-size: 2rem;
        }
    }

    .pagination-container {
        display: flex;
        justify-content: flex-end; /* لجعل الأزرار على اليمين */
        align-items: center;
        gap: 30px; /* مسافة بين العناصر */
        padding: 30px;
    }

    .bs {
        background-color: #4CAF50; /* لون الخلفية */
        color: white; /* لون النص */
        border: none;
        padding: 15px 30px; /* تكبير حجم الأزرار */
        font-size: 20px; /* تكبير النص */
        font-weight: bold; /* جعل النص عريضًا */
        border-radius: 30px; /* لجعل الأزرار دائرية */
        cursor: pointer;
        transition: all 0.3s ease; /* تأثير سلس عند التمرير */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* إضافة ظل خفيف */
    }

        .bs:hover {
            background-color: #45a049; /* لون عند التمرير */
            transform: scale(1.1); /* تكبير الأزرار قليلاً عند التمرير */
        }

    #pageNumber {
        font-size: 20px; /* تكبير النص */
        font-weight: bold; /* جعله عريضًا */
        color: #333; /* لون النص */
    }

    .btn-link {
        font-size: 30px
    }

    /*/*/
    /* For screens smaller than 1200px (Tablets and large phones) */
    @@media (max-width: 1200px) {
        .pagination-container {
            padding: 20px;
            gap: 20px;
        }

        .bs {
            font-size: 18px;
            padding: 12px 25px;
        }

        #pageNumber {
            font-size: 18px;
        }
    }



    .table th, .table td {
        font-size: 22px; /* زيادة حجم الخط في الجدول */
        text-align: center; /* محاذاة النص في الوسط */
    }

    .table thead {
        background-color: #0d1640; /* لون خلفية العناوين */
        color: white; /* لون النص */
        font-size: 20px; /* زيادة حجم خط العناوين */
        font-weight: bold
    }
    /* For screens smaller than 768px (Tablets and small phones) */
    @@media (max-width: 768px) {
        .pagination-container {
            padding: 15px;
            gap: 15px;
        }

        .bs {
            font-size: 16px;
            padding: 10px 20px;
        }

        #pageNumber {
            font-size: 16px;
        }
    }

    /* For screens smaller than 480px (Mobile Phones) */
    @@media (max-width: 480px) {
        .pagination-container {
            padding: 10px;
            gap: 10px;
            justify-content: center; /* To make buttons centered on smaller screens */
        }

        .bs {
            font-size: 14px;
            padding: 8px 15px;
        }

        #pageNumber {
            font-size: 14px;
        }


        .btn-link {
            font-size: 20px
        }
    }

    .profile-section {
        font-size: 30px;
        margin-top: 60px;
        text-align: center;
    }

    .form-check-input {
        font-size: 30px;
    }

    .form-check-label {
        font-size: 30px;
    }

    /* Media Queries for Responsiveness */

    /* For screens smaller than 1200px (Tablets and large phones) */
    @@media (max-width: 1200px) {
        .profile-section {
            font-size: 24px;
            margin-top: 50px;
        }

        .form-check-input, .form-check-label {
            font-size: 24px;
        }
    }

    /* For screens smaller than 768px (Tablets and small phones) */
    @@media (max-width: 768px) {
        .profile-section {
            font-size: 20px;
            margin-top: 40px;
        }

        .form-check-input, .form-check-label {
            font-size: 20px;
        }
    }

    /* For screens smaller than 480px (Mobile Phones) */
    @@media (max-width: 480px) {
        .profile-section {
            font-size: 16px;
            margin-top: 30px;
        }

        .form-check-input, .form-check-label {
            font-size: 16px;
        }
    }

    .no-data-message {
        color: #942929; /* لون النص */
        font-size: 28px; /* حجم الخط */
        font-weight: bold; /* جعل النص عريض */
        border-radius: 5px; /* إضافة زوايا دائرية */
        margin-top: 20px; /* مسافة فوق الصف */
        display: none
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    /* تحسينات إضافية للشاشات الكبيرة */
    @@media (min-width: 768px) {
        .modal-title {
            font-size: 28px;
        }

        .modal-body {
            font-size: 18px;
        }

        .modal-footer .btn {
            font-size: 18px;
        }
    }

    .table-responsive {
        width: 100%;
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th {
        text-align: left;
        padding: 8px;
        border: 1px solid #ddd;
    }

    @@media (max-width: 768px) {
        th, td {
            font-size: 14px !important;
            word-wrap:unset; /* يسمح بكسر الكلمات بشكل مرتب */
            text-align: left;
         
        }

    }

    @@media (max-width: 576px) {
        th, td {
            font-size: 12px;
        }

        .table {
            display: block;
        }

        th, td {
            display: block;
            text-align: right;
        }

        th {
            font-weight: bold;
            text-align: left;
        }
    }
    .bts {
        background-color: #3498db; 
        color: black; 
        border: none; 
        padding: 15px 60px; 
        font-weight: bold; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        cursor: pointer; 
        white-space: nowrap;
        font-size:22px;
        border-radius:50px;

        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; 
    }

        .bts:hover {
            background-color: #2980b9; 
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15); 
        }

        .bts:active {
            background-color: #1c6ea4; 
            transform: scale(0.97); 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

  
</style>




<div class="wave-container">
    <div class="wave-title">ORDER </div>
    <svg id="wave" style="transform:rotate(180deg); transition: 0.3s" viewBox="0 0 1440 300" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="sw-gradient-0" x1="0" x2="0" y1="1" y2="0">
                <stop stop-color="rgba(0, 0, 255, 1)" offset="0%"></stop> <!-- لون أزرق غامق -->
                <stop stop-color="rgba(144, 238, 144, 1)" offset="100%"></stop> <!-- لون أخضر فاتح -->
            </linearGradient>
        </defs>
        <path style="transform:translate(0, 0px); opacity:1" fill="url(#sw-gradient-0)"
              d="M0,43L48,71.7C96,100,192,158,288,200.7C384,144,480,272,576,250.8C672,229,768,158,864,143.3C960,129,1056,172,1152,157.7C1248,143,1344,72,1440,57.3L1440,430L0,430Z"></path>
    </svg>

    <div class="welcome-message" style="text-align: center; font-weight: bold; color: black; ">

        <h1 style="margin:35px;">Welcome to Your Orders Dashboard!</h1>
        <h2>We are excited to have you on board and ready to take on new challenges!</h2>
        <h2>Every order you take brings us closer to success. Your effort and commitment are truly appreciated.</h2>

        <h2>Stay positive, keep pushing forward, and success will follow.</h2>
        <h2>We believe in your ability to make a difference—let’s achieve great things together!</h2>
    </div>
</div>



<div class="profile-section text-center">
    <form id="availabilityForm" method="post">
        @Html.AntiForgeryToken() <!-- إدراج رمز الحماية CSRF -->
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="availabilitySwitch" name="isAvailable" value="true"
                   @(Model.IsAvailable ? "checked" : "") />
            <label class="form-check-label" for="availabilitySwitch">
                @(Model.IsAvailable ? "Ready for Tasks" : "Unavailable for Tasks")
            </label>
        </div>
    </form>
</div>



@*<div id="pagination">
        <button id="prevPage" class="btn btn-primary">Previous</button>
        <span id="pageNumber">Page 1</span>
        <button id="nextPage" class="btn btn-primary">Next</button>
    </div>*@
<div id="pagination" class="pagination-container">


    <button id="prevPage" class="btn btn-primary bs ">
        <i class="bi bi-arrow-left"></i> <!-- سهم اليسار -->

    </button> <!-- سهم اليسار -->
    <span id="pageNumber">Page 1</span>
    <button id="nextPage" class="btn btn-primary bs">
        <i class="bi bi-arrow-right"></i> <!-- سهم اليمين -->

    </button> <!-- سهم اليمين -->
</div>


<div class="table-responsive">

    <table id="ordersTable" class="table ">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>ETA</th>
                <th>TrackingNumber</th>

                <th>Status</th>
                <th>Customer</th>
                <th>Dropoff Location</th>
                <th>Pickup Location</th>
                <th>Vehicle Type</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

</div>

<!-- أزرار التنقل -->
<!-- Modal for Viewing Customer Details -->
<div class="modal fade" id="customerModal" tabindex="-1" role="dialog" aria-labelledby="customerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="customerModalLabel" style="font-size: 33px; color: #4682B4;">Customer Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="font-size: 36px; color: #4682B4;">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="customerDetailsContent">
                <!-- Customer details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bt cl" data-dismiss="modal ">Close</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirm Action</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to proceed with this action?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary cl" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmBtn">Yes</button>
            </div>
        </div>
    </div>
</div>



<script>

  $(document).ready(function () {
        $('#availabilitySwitch').change(function () {
            var isAvailable = $(this).prop('checked'); // الحصول على حالة الـ checkbox
            $.ajax({
                url: '@Url.Action("UpdateAvailability", "DriverDash")', // الرابط إلى الإجراء
                type: 'POST',
                data: {
                    __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(), // تضمين رمز الحماية CSRF
                    isAvailable: isAvailable
                },
                success: function (response) {
                    // تحديث النص بناءً على الحالة الجديدة
                    if (isAvailable) {
                        $('#availabilitySwitch').next('label').text("Ready for Tasks");
                    } else {
                        $('#availabilitySwitch').next('label').text("Unavailable for Tasks");
                    }
                },
                error: function () {
                    alert('Error updating availability.');
                }
            });
        });
    });



    $(document).ready(function () {
        // عند الضغط على الزر الذي يحتوي على data-dismiss="modal"
        $('.close ').click(function () {
            $('#customerModal').modal('hide');
            $('#confirmModal').modal('hide');
        });

        // عند الضغط على الزر الذي يحتوي على data-dismiss="modal"
        $('.cl ').click(function () {
            $('#customerModal').modal('hide');
            $('#confirmModal').modal('hide');
        });

    });

function showCustomerDetails(orderId) {
    $('#customerDetailsContent').html('<p>Loading...</p>'); // رسالة انتظار
    $.ajax({
        url: '@Url.Action("GetCustomerDetails", "admin1")',
        type: 'GET',
        data: { orderId: orderId },
        success: function (data) {
            if (data) {
                $('#customerDetailsContent').html(data); // ملء المودال بالبيانات
            } else {
                $('#customerDetailsContent').html('<p style="color: red;">No details available for this customer.</p>');
            }
            $('#customerModal').modal('show'); // عرض المودال
        },
        error: function () {
            $('#customerDetailsContent').html('<p style="color: red;">Failed to load customer details. Please try again later.</p>');
        }
    });
}




//    document.addEventListener("DOMContentLoaded", function () {
//        const table = document.getElementById("ordersTable");
//        const tbody = table.querySelector("tbody");
//        let currentPage = parseInt(localStorage.getItem("currentPage")) || 0; // استعادة الصفحة الحالية من localStorage
//        const pageSize = 10;
//        let isLoading = false;
//        let totalPages = 0;
//        let hasNextPage = false;

//        // وظيفة تحميل البيانات
//        async function loadData(page) {
//            if (isLoading) return; // إذا كان التحميل جاريًا، لا ترسل طلب جديد
//            isLoading = true;

//            try {
//                const response = await fetch(`/DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
//                console.log(`Request URL: /DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
//                if (!response.ok) {
//                    throw new Error(`HTTP error! status: ${response.status}`);
//                }
//                const data = await response.json();

//                console.log("Received Data:", data);

//                // التحقق من وجود `totalCount`
//                if (data.totalCount !== undefined) {
//                    totalPages = Math.ceil(data.totalCount / pageSize);
//                } else {
//                    console.warn("Missing totalCount in response");
//                    totalPages = 0;
//                }

//                // التحقق من وجود بيانات في الصفحة المطلوبة
//                if (data.orders.length > 0) {
//                    currentPage = page; // تحديث الصفحة الحالية فقط إذا كانت تحتوي على بيانات
//                    localStorage.setItem("currentPage", currentPage); // حفظ الصفحة الحالية في localStorage

//                    tbody.innerHTML = ""; // امسح البيانات السابقة
//                    data.orders.forEach(order => {
//                        const row = document.createElement("tr");
//                        row.innerHTML = `
//                        <td>${order.orderId || 'N/A'}</td>
//                        <td>${order.eta || 'N/A'}</td>
//                        <td>${order.track || 'N/A'}</td>
//<td id="orderStatus_${order.orderId}">${order.status || 'N/A'}</td>

//                        <td>
//                            <button class="btn btn-link" onclick="showCustomerDetails(${order.orderId})">
//                                ${order.customerName || 'N/A'}
//                            </button>
//                        </td>
//                        <td>${order.dropoffLocation || 'N/A'}</td>
//                        <td>${order.pickupLocation || 'N/A'}</td>
//                        <td>${order.vehicleType || 'N/A'}</td>
//                 <td>
//    <button class="btn bts" id="markOnTheWayBtn_${order.orderId}" style="${order.status === 'In Progress' ? '' : 'display: none; '}" onclick="openOnTheWayModal(${order.orderId})">
//        Mark On The Way
//    </button>

//    <button class="btn bts" id="markCompletedBtn_${order.orderId}" style="${order.status === 'On the Way' ? '' : 'display: none;'}" onclick="openCompletedModal(${order.orderId})">
//        Mark as Completed
//    </button>
//</td>

//                    `;
//                        tbody.appendChild(row);
//                    });

//                    hasNextPage = data.orders.length === pageSize;
//                    document.getElementById("pageNumber").innerText = `Page ${currentPage + 1}`;
//                    table.style.display = "table"; // عرض الجدول
//                } else {
//                    // إذا لم تكن هناك بيانات في الصفحة المطلوبة، لا تقم بتغيير الصفحة الحالية
//                    console.warn("No data available for the requested page. Staying on the current page.");
//                    hasNextPage = false; // لا توجد صفحة تالية
//                }

//                updatePageButtons(); // تحديث أزرار التنقل
//            } catch (error) {
//                console.error("Error loading data:", error);
//            } finally {
//                isLoading = false;
//            }
//        }

//        function updatePageButtons() {
//            const prevPageButton = document.getElementById("prevPage");
//            const nextPageButton = document.getElementById("nextPage");

//            prevPageButton.disabled = currentPage <= 0;
//            nextPageButton.disabled = currentPage >= totalPages - 1 || !hasNextPage;
//        }

//        document.getElementById("prevPage").addEventListener("click", function () {
//            if (isLoading || currentPage <= 0) return;
//            const targetPage = currentPage - 1;

//            // تحميل الصفحة السابقة إذا كانت تحتوي على بيانات
//            loadData(targetPage).then(() => {
//                if (currentPage !== targetPage) {
//                    console.warn("No data available on the previous page. Staying on the current page.");
//                }
//            });
//        });

//        document.getElementById("nextPage").addEventListener("click", function () {
//            if (isLoading || !hasNextPage) return;
//            const targetPage = currentPage + 1;

//            // تحميل الصفحة التالية إذا كانت تحتوي على بيانات
//            loadData(targetPage).then(() => {
//                if (currentPage !== targetPage) {
//                    console.warn("No data available on the next page. Staying on the current page.");
//                }
//            });
//        });

     
//        // تحميل البيانات للصفحة الحالية عند تحميل الصفحة
//        loadData(currentPage);
//    });
    document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("ordersTable");
        const tbody = table.querySelector("tbody");
        let currentPage = 0; // الصفحة الحالية تبدأ من 0
        const pageSize = 10; // حجم الصفحة
        let isLoading = false; // لتجنب الطلبات المتكررة
        let totalPages = 0;
        let hasNextPage = false;

        // تحميل البيانات من الخادم
        async function loadData(page) {
            if (isLoading) return; // منع الطلب المتكرر أثناء التحميل
            isLoading = true;

            try {
                const response = await fetch(`/DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
                console.log(`Request URL: /DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                console.log("Received Data:", data);

                // التحقق من وجود بيانات الطلبات
                let ordersArray = [];
                if (data.orders && data.orders.$values) {
                    ordersArray = data.orders.$values;
                } else {
                    console.warn("Orders are empty or invalid:", data.orders);
                }

                // التحقق من عدد البيانات الإجمالي
                if (data.totalCount !== undefined) {
                    totalPages = Math.ceil(data.totalCount / pageSize);
                } else {
                    console.warn("Missing totalCount in response");
                    totalPages = 0;
                }

                if (ordersArray.length > 0) {
                    currentPage = page; // تحديث الصفحة الحالية
                    tbody.innerHTML = ""; // مسح البيانات السابقة

                    // إضافة البيانات إلى الجدول
                    ordersArray.forEach(order => {
                        console.log("Adding order to table:", order);
                        const row = document.createElement("tr");
                        row.innerHTML = `
                        <td>${order.orderId || 'N/A'}</td>
                        <td>${order.eta || 'N/A'}</td>
                        <td>${order.track || 'N/A'}</td>
                        <td id="orderStatus_${order.orderId}">${order.status || 'N/A'}</td>
                        <td>
                            <button class="btn btn-link" onclick="showCustomerDetails(${order.orderId})">
                                ${order.customerName || 'N/A'}
                            </button>
                        </td>
                        <td>${order.dropoffLocation || 'N/A'}</td>
                        <td>${order.pickupLocation || 'N/A'}</td>
                        <td>${order.vehicleType || 'N/A'}</td>
                        <td>
                            <button class="btn bts" id="markOnTheWayBtn_${order.orderId}" 
                                style="${order.status === 'In Progress' ? '' : 'display: none;'}" 
                                onclick="openOnTheWayModal(${order.orderId})">Mark On The Way</button>
                            <button class="btn bts" id="markCompletedBtn_${order.orderId}" 
                                style="${order.status === 'On the Way' ? '' : 'display: none;'}" 
                                onclick="openCompletedModal(${order.orderId})">Mark as Completed</button>
                        </td>
                    `;
                        tbody.appendChild(row);
                    });

                    hasNextPage = ordersArray.length === pageSize;
                    document.getElementById("pageNumber").innerText = `Page ${currentPage + 1}`;
                    table.style.display = "table";
                } else {
                    console.warn("No data available for the requested page.");
                    tbody.innerHTML = "<tr><td colspan='8'>No data available for the requested page.</td></tr>";
                    hasNextPage = false;
                }

                updatePageButtons(); // تحديث أزرار التنقل
            } catch (error) {
                console.error("Error loading data:", error);
            } finally {
                isLoading = false;
            }
        }

        // تحديث حالة أزرار التنقل
        function updatePageButtons() {
            const prevPageButton = document.getElementById("prevPage");
            const nextPageButton = document.getElementById("nextPage");

            prevPageButton.disabled = currentPage <= 0;
            nextPageButton.disabled = currentPage >= totalPages - 1 || !hasNextPage;
        }

        // الزر السابق
        document.getElementById("prevPage").addEventListener("click", function () {
            if (isLoading || currentPage <= 0) return;
            loadData(currentPage - 1);
        });

        // الزر التالي
        document.getElementById("nextPage").addEventListener("click", function () {
            if (isLoading || !hasNextPage) return;
            loadData(currentPage + 1);
        });

        // تحميل الصفحة الأولى عند تحميل الصفحة
        loadData(currentPage);
    });

    function openOnTheWayModal(orderId) {
        $('#confirmModal').modal('show');
        document.getElementById('confirmBtn').onclick = function () {
            $.ajax({
                url: '/DriverDash/MarkOrderOnTheWay', // تحديث الحالة إلى "On the Way"
                type: 'POST',
                data: { orderId: orderId },
                success: function (response) {
                    console.log(response); // عرض الاستجابة للتحقق
                    if (response.success) {
                        // تحديث حالة الطلب في الجدول
                        $(`#orderStatus_${orderId}`).text("On the Way");

                        // إخفاء زر "Mark On The Way"
                        $(`#markOnTheWayBtn_${orderId}`).hide();

                        // تحديث الزر ليظهر "Mark as Completed"
                        if ($(`#markCompletedBtn_${orderId}`).length === 0) {
                            // إضافة الزر إذا لم يكن موجودًا
                            $(`#markOnTheWayBtn_${orderId}`).after(`
                            <button class="btn btn-sm" id="markCompletedBtn_${orderId}" onclick="openCompletedModal(${orderId})">Mark as Completed</button>
                        `);
                        } else {
                            // إظهار الزر إذا كان مخفيًا
                            $(`#markCompletedBtn_${orderId}`).css('display', 'inline-block');
                        }

                        // إغلاق نافذة التأكيد
                        $('#confirmModal').modal('hide');
                    } else {
                        alert(response.message);
                    }
                },
                error: function () {
                    alert('An error occurred while updating the order status.');
                }
            });
        };
    }



    // وظيفة لفتح نافذة "Completed"
    function openCompletedModal(orderId) {
        $('#confirmModal').modal('show');
        document.getElementById('confirmBtn').onclick = function () {
            $.ajax({
                url: '/DriverDash/MarkOrderCompleted', // تحديث الحالة إلى "Completed"
                type: 'POST',
                data: { orderId: orderId },
                success: function (response) {
                    console.log(response); // للتحقق من الاستجابة
                    if (response.success) {
                        // تحديث حالة الطلب
                        $(`#orderStatus_${orderId}`).text("Completed");

                        // إخفاء جميع الأزرار المرتبطة بالطلب
                        $(`#markOnTheWayBtn_${orderId}`).hide();
                        $(`#markCompletedBtn_${orderId}`).hide();

                        // إغلاق نافذة التأكيد
                        $('#confirmModal').modal('hide');
                    } else {
                        alert(response.message);
                    }
                },
                error: function () {
                    alert('An error occurred while updating the order status.');
                }
            });
        };
    }


    //function openOnTheWayModal(orderId) {
    //    $('#confirmModal').modal('show');
    //    document.getElementById('confirmBtn').onclick = function () {
    //        const form = document.createElement("form");
    //        form.method = "post";
    //        form.action = `/DriverDash/MarkOrderOnTheWay`;

    //        const input = document.createElement("input");
    //        input.type = "hidden";
    //        input.name = "orderId";
    //        input.value = orderId;

    //        form.appendChild(input);
    //        document.body.appendChild(form);
    //        form.submit();
    //    };
    //}

    //function openCompletedModal(orderId) {
    //    $('#confirmModal').modal('show');
    //    document.getElementById('confirmBtn').onclick = function () {
    //        const form = document.createElement("form");
    //        form.method = "post";
    //        form.action = `/DriverDash/MarkOrderCompleted`;

    //        const input = document.createElement("input");
    //        input.type = "hidden";
    //        input.name = "orderId";
    //        input.value = orderId;

    //        form.appendChild(input);
    //        document.body.appendChild(form);
    //        form.submit();
    //    };
    //}
 





////    document.addEventListener("DOMContentLoaded", function () {
////        const table = document.getElementById("ordersTable");
////        const tbody = table.querySelector("tbody");
////        let currentPage = parseInt(localStorage.getItem("currentPage")) || 0; // حفظ الصفحة الحالية في الذاكرة
////        const pageSize = 2;
////        let isLoading = false;
////        let totalPages = 0;
////        let hasNextPage = false;

////        // وظيفة تحميل البيانات
////        async function loadData(page) {
////            if (isLoading) return; // إذا كان التحميل جاريًا، لا ترسل طلب جديد
////            isLoading = true;

////            try {
////                const response = await fetch(`/DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
////                console.log(`Request URL: /DriverDash/Dashboard?page=${page}&pageSize=${pageSize}`);
////                if (!response.ok) {
////                    throw new Error(`HTTP error! status: ${response.status}`);
////                }
////                const data = await response.json();

////                console.log("Received Data:", data);

////                totalPages = Math.ceil(data.totalCount / pageSize);

////                if (data.orders.length > 0) {
////                    tbody.innerHTML = ""; // امسح البيانات السابقة
////                    data.orders.forEach(order => {
////                        const row = document.createElement("tr");
////                        row.innerHTML = `
////                <td>${order.orderId || 'N/A'}</td>
////                 <td>${order.eta || 'N/A'}</td>
////<td>${order.track || 'N/A'}</td>
////<td>${order.status || 'N/A'}</td>
////<td>
////    <button class="btn btn-link " onclick="showCustomerDetails(${order.orderId})">
////        ${order.customerName || 'N/A'}
////    </button>
////</td>
////<td>${order.dropoffLocation || 'N/A'}</td>
////<td>${order.pickupLocation || 'N/A'}</td>
////<td>${order.vehicleType || 'N/A'}</td>
////<td>
////    ${order.status === "In Progress" ? `
////        <button class="btn btn-sm" onclick="openOnTheWayModal(${order.orderId})">Mark On The Way</button>
////    ` : ""}
////    ${order.status === "On the Way" ? `
////        <button class="btn btn-sm" onclick="openCompletedModal(${order.orderId})">Mark as Completed</button>
////    ` : ""}
////</td>


////                `;
////                        tbody.appendChild(row);
////                    });

////                    // تحديث متغير `hasNextPage`
////                    hasNextPage = data.orders.length === pageSize;

////                    document.getElementById("pageNumber").innerText = `Page ${page + 1}`;
////                    updatePageButtons(); // تحديث الأزرار
////                }
////                else {
////                    tbody.innerHTML = "";
////                    //const noDataRow = document.createElement("tr");
////                    //tbody.appendChild(noDataRow);
////                    showNoDataMessage();

////                    table.style.display = "none";

////                    hasNextPage = false;




////                    updatePageButtons(); // تحديث الأزرار
////                }
////            } catch (error) {
////                console.error("Error loading data:", error);
////            } finally {
////                isLoading = false;
////            }
////        }

////        function updatePageButtons() {
////            const prevPageButton = document.getElementById("prevPage");
////            const nextPageButton = document.getElementById("nextPage");

////            prevPageButton.disabled = currentPage <= 0;
////            nextPageButton.disabled = !hasNextPage;
////        }

////        document.getElementById("prevPage").addEventListener("click", function () {
////            if (isLoading) return;
////            if (currentPage > 0) {
////                currentPage--;
////                localStorage.setItem("currentPage", currentPage); // حفظ الصفحة الحالية في الذاكرة
////                loadData(currentPage);
////            }
////        });

////        document.getElementById("nextPage").addEventListener("click", function () {
////            if (isLoading) return;
////            if (hasNextPage) {
////                currentPage++;
////                localStorage.setItem("currentPage", currentPage); // حفظ الصفحة الحالية في الذاكرة
////                loadData(currentPage);
////            }
////        });



////        // تحميل البيانات للصفحة الحالية عند تحميل الصفحة
////        loadData(currentPage);
////  });
</script>
